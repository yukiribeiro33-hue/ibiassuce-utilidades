<!DOCTYPE html>

<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel — Utilidades IBC</title>



  <style>
    :root{
      --bg:#0b1020; --card:#111833; --text:#e6eef8; --muted:#8aa0b9;
      --primary:#0ea5e9; --accent:#22c55e; --danger:#ef4444;
    }
    *{box-sizing:border-box}
    body{margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;
      background:linear-gradient(180deg,#0a0f1f 0%, #0c1226 60%, #0a0f1f 100%);
      color:var(--text); min-height:100vh; display:flex; flex-direction:column;
    }
    header{position:sticky; top:0; background:rgba(10,15,31,.7); backdrop-filter: blur(8px); border-bottom:1px solid rgba(255,255,255,.06);}
    .wrap{max-width:1200px; margin:0 auto; padding:16px}
    .title{display:flex; align-items:center; justify-content:space-between; gap:12px}
    .btn{border:none; padding:10px 14px; border-radius:10px; cursor:pointer; font-weight:700}
    .btn.primary{background:var(--primary); color:white}
    .btn.accent{background:var(--accent); color:#041}
    .btn.danger{background:var(--danger); color:white}
    .btn.ghost{background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.15)}
    .grid{display:grid; grid-template-columns: 1fr 1fr; gap:16px}
    .card{background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:16px; padding:14px}
    label{display:block; font-size:13px; color:var(--muted); margin:10px 0 4px}
    input, select, textarea{
      width:100%; background:#0b1228; border:1px solid rgba(255,255,255,.12); color:var(--text);
      border-radius:10px; padding:10px; outline:none;
    }
    textarea{min-height:84px; resize:vertical}
    .list{display:grid; grid-template-columns: repeat(12,1fr); gap:12px}
    .row{grid-column: span 12; display:grid; grid-template-columns: 80px 1fr 120px 120px 120px; gap:10px; align-items:center; background:#0b1228; border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:8px}
    .row img{width:80px; height:60px; object-fit:cover; border-radius:8px; background:#0b132a}
    .pill{font-size:12px; color:#0b132a; background:#c6f6d5; padding:3px 8px; border-radius:999px; display:inline-block}
    .muted{color:var(--muted)}
    .images{display:flex; gap:8px; flex-wrap:wrap}
    .images img{width:70px; height:50px; object-fit:cover; border-radius:8px; border:1px solid rgba(255,255,255,.12)}
    .inline{display:flex; gap:8px; align-items:center}
    .footer{margin-top:auto; padding:16px; text-align:center; color:var(--muted)}
    .section-title{margin:0 0 10px; font-size:18px}
    @media(max-width:900px){ .grid{grid-template-columns: 1fr} .row{grid-template-columns: 60px 1fr 100px 100px 100px} }
  </style>
</head>
<body>
  <header>
    <div class="wrap title">
      <div>
        <h1 style="margin:0">Painel de Controle — Utilidades IBC</h1>
        <div class="muted">Gerencie produtos, categorias e banners (carrossel até 5 fotos)</div>
      </div>
      <div class="inline">
        <a class="btn ghost" href="index.html">Ver loja</a>
        <button class="btn ghost" id="exportBtn">Exportar JSON</button>
        <label class="btn ghost" style="cursor:pointer">
          Importar JSON
          <input type="file" id="importFile" accept="application/json" style="display:none">
        </label>
      </div>
    </div>
  </header>

  <main class="wrap" style="display:flex; flex-direction:column; gap:16px">
    <section class="grid">
      <div class="card">
        <h2 class="section-title">Produto</h2>
        <input type="hidden" id="pid">
        <label>Nome</label>
        <input id="pname" placeholder="Ex: Jarra de Vidro 1L" required>
        <label>Descrição</label>
        <textarea id="pdesc" placeholder="Detalhes do produto"></textarea>
        <div class="grid">
          <div>
            <label>Preço (R$)</label>
            <input id="pprice" type="number" min="0" step="0.01" placeholder="0,00">
          </div>
          <div>
            <label>Categoria</label>
            <div class="inline">
              <select id="pcat"></select>
              <input id="newCat" placeholder="Nova categoria">
              <button class="btn ghost" id="addCatBtn" title="Adicionar categoria">+</button>
            </div>
          </div>
        </div>
        <label>Imagens (até 5)</label>
        <div class="inline">
          <input type="file" id="pimgs" accept="image/*" multiple>
          <input id="imgUrl" placeholder="https://url-da-imagem.jpg">
          <button class="btn ghost" id="addImgUrlBtn">Adicionar URL</button>
        </div>
        <div class="images" id="imgPreview"></div>
        <div class="inline" style="margin-top:10px">
          <button class="btn primary" id="saveBtn">Salvar</button>
          <button class="btn danger" id="resetBtn">Limpar</button>
        </div>
      </div>

      <div class="card">
        <h2 class="section-title">Banners do Carrossel (até 5 fotos)</h2>
        <div class="inline">
          <input type="file" id="bannerFiles" accept="image/*" multiple>
          <input id="bannerUrl" placeholder="https://url-da-imagem.jpg">
          <button class="btn ghost" id="addBannerUrlBtn">Adicionar URL</button>
        </div>
        <div class="images" id="bannerPreview"></div>
        <div class="inline" style="margin-top:10px">
          <button class="btn primary" id="saveBannersBtn">Salvar Banners</button>
          <button class="btn danger" id="clearBannersBtn">Limpar Banners</button>
        </div>
      </div>
    </section>

    <section class="card">
      <h2 class="section-title">Produtos cadastrados</h2>
      <div class="inline" style="gap:6px; margin-bottom:8px">
        <input id="filterQ" placeholder="Buscar por nome/descrição">
        <select id="filterCat"></select>
        <button class="btn ghost" id="clearFilterBtn">Limpar filtro</button>
      </div>
      <div class="list" id="productList"></div>
    </section>
  </main>

  <div class="footer">As alterações são salvas no seu navegador (localStorage). Faça backup com Exportar JSON.</div>

<script>
const DB_KEY = 'utilidades_ibc_products_v1';
const BANNER_KEY = 'utilidades_ibc_banners_v1';
const CATEGORIES_KEY = 'utilidades_ibc_categories_v1';

/* ===== Helpers ===== */
function getProducts(){ return JSON.parse(localStorage.getItem(DB_KEY) || '[]'); }
function setProducts(p){ localStorage.setItem(DB_KEY, JSON.stringify(p)); }
function getBanners(){ return JSON.parse(localStorage.getItem(BANNER_KEY) || '[]'); }
function setBanners(b){ localStorage.setItem(BANNER_KEY, JSON.stringify(b.slice(0,5))); }
function getCategories(){ return JSON.parse(localStorage.getItem(CATEGORIES_KEY) || '[]'); }
function setCategories(c){ localStorage.setItem(CATEGORIES_KEY, JSON.stringify([...new Set(c)])); }

function toBase64(file){
  return new Promise((resolve,reject)=>{
    const r = new FileReader();
    r.onload = ()=> resolve(r.result);
    r.onerror = reject;
    r.readAsDataURL(file);
  });
}

function money(n){ return Number(n||0).toFixed(2); }

/* ===== UI refs ===== */
const pid = document.getElementById('pid');
const pname = document.getElementById('pname');
const pdesc = document.getElementById('pdesc');
const pprice = document.getElementById('pprice');
const pcat = document.getElementById('pcat');
const newCat = document.getElementById('newCat');
const addCatBtn = document.getElementById('addCatBtn');

const pimgs = document.getElementById('pimgs');
const imgUrl = document.getElementById('imgUrl');
const addImgUrlBtn = document.getElementById('addImgUrlBtn');
const imgPreview = document.getElementById('imgPreview');

const saveBtn = document.getElementById('saveBtn');
const resetBtn = document.getElementById('resetBtn');

const productList = document.getElementById('productList');

const filterQ = document.getElementById('filterQ');
const filterCat = document.getElementById('filterCat');
const clearFilterBtn = document.getElementById('clearFilterBtn');

const bannerFiles = document.getElementById('bannerFiles');
const bannerUrl = document.getElementById('bannerUrl');
const addBannerUrlBtn = document.getElementById('addBannerUrlBtn');
const bannerPreview = document.getElementById('bannerPreview');
const saveBannersBtn = document.getElementById('saveBannersBtn');
const clearBannersBtn = document.getElementById('clearBannersBtn');

/* ===== State ===== */
let imgList = []; // dataURL or URL strings
let filter = {q:'',cat:'Todas'};

/* ===== Init ===== */
function ensureSeed(){
  if(!localStorage.getItem(DB_KEY)){
    const cats = ["Cozinha","Limpeza","Eletrônicos","Vestuário","Ferramentas"];
    const products = [];
    for(let i=1;i<=50;i++){
      const c = cats[(i-1)%cats.length];
      products.push({
        id: crypto.randomUUID(),
        name: `${c} — Produto ${i}`,
        description: `Produto ${i} da categoria ${c}. Qualidade e preço justo.`,
        price: (19.9 + (i%10)*5).toFixed(2),
        category: c,
        images: [
          `https://picsum.photos/seed/ibc${i}/800/600`,
          `https://picsum.photos/seed/ibc${i}b/800/600`
        ],
        featured: i <= 5
      });
    }
    setProducts(products);
    setCategories(cats);
    localStorage.setItem(BANNER_KEY, JSON.stringify(products.filter(p=>p.featured).slice(0,5).map(p=>p.images[0])));
  }
}
function loadCategoriesToSelect(){
  const cats = ['Selecione...', ...getCategories()];
  pcat.innerHTML = cats.map((c,i)=>`<option value="${i===0?'':c}">${c}</option>`).join('');
  const fCats = ['Todas', ...getCategories()];
  filterCat.innerHTML = fCats.map(c=>`<option>${c}</option>`).join('');
}
function renderImgPreview(){
  imgPreview.innerHTML = '';
  imgList.forEach((src, idx)=>{
    const w = document.createElement('div');
    w.style.position='relative';
    const im = document.createElement('img');
    im.src = src;
    im.alt = 'Imagem '+(idx+1);
    im.title = 'Arraste para reordenar';
    im.draggable = true;
    im.ondragstart = ev => ev.dataTransfer.setData('text/plain', idx);
    im.ondragover = ev => ev.preventDefault();
    im.ondrop = ev => {
      ev.preventDefault();
      const from = Number(ev.dataTransfer.getData('text/plain'));
      const to = idx;
      const item = imgList.splice(from,1)[0];
      imgList.splice(to,0,item);
      renderImgPreview();
    };
    const del = document.createElement('button');
    del.textContent = '×';
    del.style.position='absolute'; del.style.top='-6px'; del.style.right='-6px';
    del.className='btn danger';
    del.style.padding='2px 8px'; del.style.borderRadius='999px';
    del.onclick = ()=>{ imgList.splice(idx,1); renderImgPreview(); };
    w.appendChild(im); w.appendChild(del);
    imgPreview.appendChild(w);
  });
}
function resetForm(){
  pid.value=''; pname.value=''; pdesc.value=''; pprice.value=''; pcat.value='';
  imgList=[]; renderImgPreview(); pimgs.value=''; imgUrl.value='';
}

function renderBannerPreview(){
  bannerPreview.innerHTML = '';
  getBanners().forEach((src, idx)=>{
    const w = document.createElement('div');
    w.style.position='relative';
    const im = document.createElement('img');
    im.src = src; im.alt='Banner '+(idx+1);
    const del = document.createElement('button');
    del.textContent='×'; del.className='btn danger'; del.style.position='absolute'; del.style.top='-6px'; del.style.right='-6px';
    del.style.padding='2px 8px'; del.style.borderRadius='999px';
    del.onclick = ()=>{ const arr=getBanners(); arr.splice(idx,1); setBanners(arr); renderBannerPreview(); };
    w.appendChild(im); w.appendChild(del);
    bannerPreview.appendChild(w);
  });
}

function renderList(){
  const q = filter.q.trim().toLowerCase();
  const data = getProducts().filter(p=>{
    const okQ = !q || p.name.toLowerCase().includes(q) || p.description.toLowerCase().includes(q);
    const okC = filter.cat==='Todas' || p.category===filter.cat;
    return okQ && okC;
  });
  productList.innerHTML='';
  data.forEach(p=>{
    const row = document.createElement('div');
    row.className='row';
    row.innerHTML = `
      <img src="${(p.images&&p.images[0])||''}" alt="${p.name}">
      <div>
        <strong>${p.name}</strong>
        <div class="muted">${p.description}</div>
      </div>
      <div><span class="pill">R$ ${Number(p.price).toFixed(2)}</span></div>
      <div class="muted">${p.category}</div>
      <div class="inline">
        <button class="btn ghost" data-edit>Editar</button>
        <button class="btn danger" data-del>Excluir</button>
      </div>
    `;
    row.querySelector('[data-edit]').onclick = ()=> loadIntoForm(p.id);
    row.querySelector('[data-del]').onclick = ()=> {
      if(confirm('Excluir este produto?')){
        const arr = getProducts().filter(x=>x.id!==p.id);
        setProducts(arr);
        renderList();
      }
    };
    productList.appendChild(row);
  });
}

function loadIntoForm(id){
  const p = getProducts().find(x=>x.id===id);
  if(!p) return;
  pid.value = p.id;
  pname.value = p.name;
  pdesc.value = p.description;
  pprice.value = p.price;
  pcat.value = getCategories().includes(p.category) ? p.category : '';
  imgList = [...(p.images||[])].slice(0,5);
  renderImgPreview();
  window.scrollTo({top:0, behavior:'smooth'});
}

/* ===== Events ===== */
addCatBtn.onclick = ()=>{
  const val = newCat.value.trim();
  if(!val) return;
  const cats = getCategories(); cats.push(val); setCategories(cats);
  loadCategoriesToSelect();
  pcat.value = val;
  newCat.value='';
};

pimgs.onchange = async (e)=>{
  const files = [...e.target.files].slice(0, 5 - imgList.length);
  for(const f of files){
    const b64 = await toBase64(f);
    imgList.push(b64);
  }
  renderImgPreview();
  pimgs.value='';
};
addImgUrlBtn.onclick = ()=>{
  const url = imgUrl.value.trim();
  if(!url) return;
  if(imgList.length>=5){ alert('Máximo de 5 imagens.'); return; }
  imgList.push(url);
  renderImgPreview();
  imgUrl.value='';
};

saveBtn.onclick = ()=>{
  if(!pname.value){ alert('Informe o nome.'); return; }
  const p = {
    id: pid.value || crypto.randomUUID(),
    name: pname.value.trim(),
    description: pdesc.value.trim(),
    price: money(pprice.value),
    category: pcat.value || (newCat.value.trim() || 'Outros'),
    images: imgList.slice(0,5)
  };
  const arr = getProducts();
  const idx = arr.findIndex(x=>x.id===p.id);
  if(idx>=0) arr[idx]=p; else arr.unshift(p);
  setProducts(arr);
  setCategories([...getCategories(), p.category]);
  resetForm();
  loadCategoriesToSelect();
  renderList();
  alert('Salvo!');
};

resetBtn.onclick = resetForm;

filterQ.oninput = ()=>{ filter.q = filterQ.value; renderList(); };
filterCat.onchange = ()=>{ filter.cat = filterCat.value; renderList(); };
clearFilterBtn.onclick = ()=>{ filter={q:'',cat:'Todas'}; filterQ.value=''; filterCat.value='Todas'; renderList(); };

addBannerUrlBtn.onclick = ()=>{
  const url = bannerUrl.value.trim(); if(!url) return;
  const arr = getBanners(); if(arr.length>=5){ alert('Máximo 5 banners.'); return; }
  arr.push(url); setBanners(arr); bannerUrl.value=''; renderBannerPreview();
};
bannerFiles.onchange = async (e)=>{
  const arr = getBanners();
  const space = 5 - arr.length;
  const files = [...e.target.files].slice(0, space);
  for(const f of files){
    const b64 = await toBase64(f);
    arr.push(b64);
  }
  setBanners(arr);
  renderBannerPreview();
  bannerFiles.value='';
};
saveBannersBtn.onclick = ()=>{ alert('Banners salvos! Acesse a loja para ver.'); };
clearBannersBtn.onclick = ()=>{ if(confirm('Limpar todos os banners?')){ setBanners([]); renderBannerPreview(); } };

document.getElementById('exportBtn').onclick = ()=>{
  const data = {
    products: getProducts(),
    banners: getBanners(),
    categories: getCategories()
  };
  const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href=url; a.download='utilidades-ibc-backup.json'; a.click();
  URL.revokeObjectURL(url);
};
document.getElementById('importFile').onchange = async (e)=>{
  const file = e.target.files[0]; if(!file) return;
  const text = await file.text();
  try{
    const data = JSON.parse(text);
    if(data.products) setProducts(data.products);
    if(data.banners) setBanners(data.banners);
    if(data.categories) setCategories(data.categories);
    loadCategoriesToSelect(); renderBannerPreview(); renderList();
    alert('Importado com sucesso!');
  }catch(err){
    alert('Arquivo inválido.');
  }
};

// Boot
ensureSeed();
loadCategoriesToSelect();
renderBannerPreview();
renderList();
</script>
</body>
</html>
